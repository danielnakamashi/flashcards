{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport firebase from 'firebase/app';\nimport 'firebase/auth';\n\nvar FirebaseService = /*#__PURE__*/function () {\n  function FirebaseService(options) {\n    _classCallCheck(this, FirebaseService);\n\n    _defineProperty(this, \"firebase\", void 0);\n\n    if (firebase.apps.length === 0) {\n      firebase.initializeApp(options);\n    }\n  }\n\n  _createClass(FirebaseService, [{\n    key: \"getUserToken\",\n    value: function getUserToken() {\n      var firebaseUser = firebase.auth().currentUser;\n\n      if (!firebaseUser) {\n        return Promise.resolve(null);\n      }\n\n      return firebaseUser.getIdToken(true);\n    }\n  }, {\n    key: \"getCurrentUser\",\n    value: function () {\n      var _getCurrentUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _firebaseUser$email, _firebaseUser$emailVe, _firebaseUser$display, _firebaseUser$photoUR;\n\n        var firebaseUser;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                firebaseUser = firebase.auth().currentUser;\n\n                if (firebaseUser) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", null);\n\n              case 3:\n                return _context.abrupt(\"return\", {\n                  email: (_firebaseUser$email = firebaseUser.email) !== null && _firebaseUser$email !== void 0 ? _firebaseUser$email : '',\n                  emailVerified: (_firebaseUser$emailVe = firebaseUser.emailVerified) !== null && _firebaseUser$emailVe !== void 0 ? _firebaseUser$emailVe : false,\n                  name: (_firebaseUser$display = firebaseUser.displayName) !== null && _firebaseUser$display !== void 0 ? _firebaseUser$display : '',\n                  photoUrl: (_firebaseUser$photoUR = firebaseUser.photoURL) !== null && _firebaseUser$photoUR !== void 0 ? _firebaseUser$photoUR : '',\n                  uid: firebaseUser.uid\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getCurrentUser() {\n        return _getCurrentUser.apply(this, arguments);\n      }\n\n      return getCurrentUser;\n    }()\n  }, {\n    key: \"userObserver\",\n    value: function userObserver(callback) {\n      firebase.auth().onAuthStateChanged( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(firebaseUser) {\n          var _firebaseUser$email2, _firebaseUser$emailVe2, _firebaseUser$display2, _firebaseUser$photoUR2;\n\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  if (firebaseUser) {\n                    _context2.next = 2;\n                    break;\n                  }\n\n                  return _context2.abrupt(\"return\", callback(null));\n\n                case 2:\n                  callback({\n                    email: (_firebaseUser$email2 = firebaseUser.email) !== null && _firebaseUser$email2 !== void 0 ? _firebaseUser$email2 : '',\n                    emailVerified: (_firebaseUser$emailVe2 = firebaseUser.emailVerified) !== null && _firebaseUser$emailVe2 !== void 0 ? _firebaseUser$emailVe2 : false,\n                    name: (_firebaseUser$display2 = firebaseUser.displayName) !== null && _firebaseUser$display2 !== void 0 ? _firebaseUser$display2 : '',\n                    photoUrl: (_firebaseUser$photoUR2 = firebaseUser.photoURL) !== null && _firebaseUser$photoUR2 !== void 0 ? _firebaseUser$photoUR2 : '',\n                    uid: firebaseUser.uid\n                  });\n\n                case 3:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n  }]);\n\n  return FirebaseService;\n}();\n\nexport { FirebaseService };","map":{"version":3,"sources":["/Users/daniel.nakamashi/Documents/projects/clean-flashcards/node_modules/@flashcards/client/src/service/firebase/service.ts"],"names":["firebase","FirebaseService","options","apps","length","initializeApp","firebaseUser","auth","currentUser","Promise","resolve","getIdToken","email","emailVerified","name","displayName","photoUrl","photoURL","uid","callback","onAuthStateChanged"],"mappings":";;;;;AAAA,OAAOA,QAAP,MAAqB,cAArB;AACA,OAAO,eAAP;;IAMMC,e;AAGJ,2BAAYC,OAAZ,EAA8B;AAAA;;AAAA;;AAC5B,QAAIF,QAAQ,CAACG,IAAT,CAAcC,MAAd,KAAyB,CAA7B,EAAgC;AAC9BJ,MAAAA,QAAQ,CAACK,aAAT,CAAuBH,OAAvB;AACD;AACF;;;;mCAE+B;AAC9B,UAAMI,YAAY,GAAGN,QAAQ,CAACO,IAAT,GAAgBC,WAArC;;AAEA,UAAI,CAACF,YAAL,EAAmB;AACjB,eAAOG,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;AACD;;AAED,aAAOJ,YAAY,CAACK,UAAb,CAAwB,IAAxB,CAAP;AACD;;;;;;;;;;;;AAGOL,gBAAAA,Y,GAAeN,QAAQ,CAACO,IAAT,GAAgBC,W;;oBAEhCF,Y;;;;;iDACI,I;;;iDAGF;AACLM,kBAAAA,KAAK,yBAAEN,YAAY,CAACM,KAAf,qEAAwB,EADxB;AAELC,kBAAAA,aAAa,2BAAEP,YAAY,CAACO,aAAf,yEAAgC,KAFxC;AAGLC,kBAAAA,IAAI,2BAAER,YAAY,CAACS,WAAf,yEAA8B,EAH7B;AAILC,kBAAAA,QAAQ,2BAAEV,YAAY,CAACW,QAAf,yEAA2B,EAJ9B;AAKLC,kBAAAA,GAAG,EAAEZ,YAAY,CAACY;AALb,iB;;;;;;;;;;;;;;;;;;iCASIC,Q,EAA0C;AACrDnB,MAAAA,QAAQ,CAACO,IAAT,GAAgBa,kBAAhB;AAAA,4EAAmC,kBAAMd,YAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,sBAC5BA,YAD4B;AAAA;AAAA;AAAA;;AAAA,oDAExBa,QAAQ,CAAC,IAAD,CAFgB;;AAAA;AAKjCA,kBAAAA,QAAQ,CAAC;AACPP,oBAAAA,KAAK,0BAAEN,YAAY,CAACM,KAAf,uEAAwB,EADtB;AAEPC,oBAAAA,aAAa,4BAAEP,YAAY,CAACO,aAAf,2EAAgC,KAFtC;AAGPC,oBAAAA,IAAI,4BAAER,YAAY,CAACS,WAAf,2EAA8B,EAH3B;AAIPC,oBAAAA,QAAQ,4BAAEV,YAAY,CAACW,QAAf,2EAA2B,EAJ5B;AAKPC,oBAAAA,GAAG,EAAEZ,YAAY,CAACY;AALX,mBAAD,CAAR;;AALiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAnC;;AAAA;AAAA;AAAA;AAAA;AAaD;;;;;;AAGH,SAASjB,eAAT","sourcesContent":["import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { GetCurrentUserService } from '../../usecase/GetCurrentUser'\nimport { GetUserTokenService } from '../../usecase/GetUserToken'\nimport { UserObserverService } from '../../usecase/UserObserver'\nimport { UserData } from '../../usecase/protocols'\n\nclass FirebaseService implements UserObserverService, GetCurrentUserService, GetUserTokenService {\n  private readonly firebase: firebase.app.App\n\n  constructor(options: unknown) {\n    if (firebase.apps.length === 0) {\n      firebase.initializeApp(options)\n    }\n  }\n\n  getUserToken(): Promise<string> {\n    const firebaseUser = firebase.auth().currentUser\n\n    if (!firebaseUser) {\n      return Promise.resolve(null)\n    }\n\n    return firebaseUser.getIdToken(true)\n  }\n\n  async getCurrentUser(): Promise<UserData> {\n    const firebaseUser = firebase.auth().currentUser\n\n    if (!firebaseUser) {\n      return null\n    }\n\n    return {\n      email: firebaseUser.email ?? '',\n      emailVerified: firebaseUser.emailVerified ?? false,\n      name: firebaseUser.displayName ?? '',\n      photoUrl: firebaseUser.photoURL ?? '',\n      uid: firebaseUser.uid,\n    }\n  }\n\n  userObserver(callback: (user: UserData) => void): void {\n    firebase.auth().onAuthStateChanged(async firebaseUser => {\n      if (!firebaseUser) {\n        return callback(null)\n      }\n\n      callback({\n        email: firebaseUser.email ?? '',\n        emailVerified: firebaseUser.emailVerified ?? false,\n        name: firebaseUser.displayName ?? '',\n        photoUrl: firebaseUser.photoURL ?? '',\n        uid: firebaseUser.uid,\n      })\n    })\n  }\n}\n\nexport { FirebaseService }\n"]},"metadata":{},"sourceType":"module"}