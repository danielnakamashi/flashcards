{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { gql } from '@apollo/client';\nimport { TopicData } from '../../usecase';\nimport { Observer } from '../Observer';\nimport { CardData } from '../../usecase/protocols/CardData';\n\nclass GraphqlService {\n  constructor(client) {\n    this.client = client;\n  }\n\n  async getTopics(token) {\n    const {\n      data\n    } = await this.client.query({\n      query: GraphqlService.queryTopics,\n      context: {\n        headers: {\n          authentication: token\n        }\n      },\n      fetchPolicy: 'no-cache'\n    });\n    return data.topics.map(topicData => new TopicData(topicData));\n  }\n\n  getTopicsObserver(token) {\n    return new Observer((next, error) => {\n      const observable = this.client.watchQuery({\n        query: GraphqlService.queryTopics,\n        context: {\n          headers: {\n            authentication: token\n          }\n        }\n      });\n      observable.subscribe({\n        next: ({\n          data\n        }) => {\n          next(data.topics.map(topicData => new TopicData(topicData)));\n        },\n        error\n      });\n    });\n  }\n\n  async getTopic(token, topicId) {\n    const {\n      data\n    } = await this.client.query({\n      query: GraphqlService.queryTopic,\n      variables: {\n        topicId\n      },\n      context: {\n        headers: {\n          authentication: token\n        }\n      },\n      fetchPolicy: 'no-cache'\n    });\n    return new TopicData({\n      id: data.topic.id,\n      name: data.topic.name,\n      cards: data.topic.cards.map(({\n        id,\n        question,\n        answer\n      }) => new CardData({\n        id,\n        front: question,\n        back: answer\n      }))\n    });\n  }\n\n  async addTopic(token, inputData) {\n    const context = {\n      headers: {\n        authentication: token\n      }\n    };\n    const {\n      data\n    } = await this.client.mutate({\n      mutation: GraphqlService.mutationAddTopic,\n      variables: {\n        name: inputData.name\n      },\n      context,\n      refetchQueries: [{\n        query: GraphqlService.queryTopics,\n        context\n      }]\n    });\n    return data ? new TopicData({\n      id: data.id,\n      name: data.name\n    }) : null;\n  }\n\n  async removeTopic(token, topicId) {\n    const context = {\n      headers: {\n        authentication: token\n      }\n    };\n    await this.client.mutate({\n      mutation: GraphqlService.mutationRemoveTopic,\n      variables: {\n        topicId\n      },\n      context,\n      refetchQueries: [{\n        query: GraphqlService.queryTopics,\n        context\n      }]\n    });\n    return true;\n  }\n\n  async addCard(token, inputData) {\n    const context = {\n      headers: {\n        authentication: token\n      }\n    };\n    const {\n      data\n    } = await this.client.mutate({\n      mutation: GraphqlService.mutationAddCard,\n      variables: inputData,\n      context,\n      refetchQueries: [{\n        query: GraphqlService.queryTopic,\n        variables: {\n          topicId: inputData.topicId\n        },\n        context\n      }]\n    });\n    return new CardData({\n      id: data.id,\n      front: data.question,\n      back: data.answer\n    });\n  }\n\n}\n\n_defineProperty(GraphqlService, \"queryTopics\", gql`\n    query Topics {\n      topics {\n        id\n        name\n      }\n    }\n  `);\n\n_defineProperty(GraphqlService, \"queryTopic\", gql`\n    query Topic($topicId: String!) {\n      topic(topicId: $topicId) {\n        id\n        name\n        cards {\n          id\n          question\n          answer\n        }\n      }\n    }\n  `);\n\n_defineProperty(GraphqlService, \"mutationAddTopic\", gql`\n    mutation AddTopic($name: String!) {\n      addTopic(name: $name) {\n        id\n        name\n      }\n    }\n  `);\n\n_defineProperty(GraphqlService, \"mutationRemoveTopic\", gql`\n    mutation RemoveTopic($topicId: String!) {\n      removeTopic(topicId: $topicId)\n    }\n  `);\n\n_defineProperty(GraphqlService, \"mutationAddCard\", gql`\n    mutation AddCard($topicId: String!, $question: String!, $answer: String!) {\n      addCard(topicId: $topicId, card: { question: $question, answer: $answer }) {\n        id\n        question\n        answer\n      }\n    }\n  `);\n\nexport { GraphqlService };","map":{"version":3,"sources":["/Users/daniel.nakamashi/Documents/projects/clean-flashcards/node_modules/@flashcards/client/src/service/graphql/service.ts"],"names":["gql","TopicData","Observer","CardData","GraphqlService","constructor","client","getTopics","token","data","query","queryTopics","context","headers","authentication","fetchPolicy","topics","map","topicData","getTopicsObserver","next","error","observable","watchQuery","subscribe","getTopic","topicId","queryTopic","variables","id","topic","name","cards","question","answer","front","back","addTopic","inputData","mutate","mutation","mutationAddTopic","refetchQueries","removeTopic","mutationRemoveTopic","addCard","mutationAddCard"],"mappings":";;AAAA,SAA8CA,GAA9C,QAAyD,gBAAzD;AAEA,SAGEC,SAHF,QAQO,eARP;AAUA,SAASC,QAAT,QAAyB,aAAzB;AAEA,SAASC,QAAT,QAAyB,kCAAzB;;AAGA,MAAMC,cAAN,CAOmB;AA6CjBC,EAAAA,WAAW,CAAkBC,MAAlB,EAA+D;AAAA,SAA7CA,MAA6C,GAA7CA,MAA6C;AAAE;;AAE5E,QAAMC,SAAN,CAAgBC,KAAhB,EAAqD;AACnD,UAAM;AAAEC,MAAAA;AAAF,QAAW,MAAM,KAAKH,MAAL,CAAYI,KAAZ,CAA2C;AAChEA,MAAAA,KAAK,EAAEN,cAAc,CAACO,WAD0C;AAEhEC,MAAAA,OAAO,EAAE;AACPC,QAAAA,OAAO,EAAE;AACPC,UAAAA,cAAc,EAAEN;AADT;AADF,OAFuD;AAOhEO,MAAAA,WAAW,EAAE;AAPmD,KAA3C,CAAvB;AAUA,WAAON,IAAI,CAACO,MAAL,CAAYC,GAAZ,CAAgBC,SAAS,IAAI,IAAIjB,SAAJ,CAAciB,SAAd,CAA7B,CAAP;AACD;;AAEDC,EAAAA,iBAAiB,CAACX,KAAD,EAAyC;AACxD,WAAO,IAAIN,QAAJ,CAAa,CAACkB,IAAD,EAAOC,KAAP,KAAiB;AACnC,YAAMC,UAAU,GAAG,KAAKhB,MAAL,CAAYiB,UAAZ,CAAgD;AACjEb,QAAAA,KAAK,EAAEN,cAAc,CAACO,WAD2C;AAEjEC,QAAAA,OAAO,EAAE;AACPC,UAAAA,OAAO,EAAE;AACPC,YAAAA,cAAc,EAAEN;AADT;AADF;AAFwD,OAAhD,CAAnB;AAQAc,MAAAA,UAAU,CAACE,SAAX,CAAqB;AACnBJ,QAAAA,IAAI,EAAE,CAAC;AAAEX,UAAAA;AAAF,SAAD,KAAc;AAClBW,UAAAA,IAAI,CAACX,IAAI,CAACO,MAAL,CAAYC,GAAZ,CAAgBC,SAAS,IAAI,IAAIjB,SAAJ,CAAciB,SAAd,CAA7B,CAAD,CAAJ;AACD,SAHkB;AAInBG,QAAAA;AAJmB,OAArB;AAMD,KAfM,CAAP;AAgBD;;AAED,QAAMI,QAAN,CAAejB,KAAf,EAA8BkB,OAA9B,EAAmE;AACjE,UAAM;AAAEjB,MAAAA;AAAF,QAAW,MAAM,KAAKH,MAAL,CAAYI,KAAZ,CAAsC;AAC3DA,MAAAA,KAAK,EAAEN,cAAc,CAACuB,UADqC;AAE3DC,MAAAA,SAAS,EAAE;AACTF,QAAAA;AADS,OAFgD;AAK3Dd,MAAAA,OAAO,EAAE;AACPC,QAAAA,OAAO,EAAE;AACPC,UAAAA,cAAc,EAAEN;AADT;AADF,OALkD;AAU3DO,MAAAA,WAAW,EAAE;AAV8C,KAAtC,CAAvB;AAaA,WAAO,IAAId,SAAJ,CAAc;AACnB4B,MAAAA,EAAE,EAAEpB,IAAI,CAACqB,KAAL,CAAWD,EADI;AAEnBE,MAAAA,IAAI,EAAEtB,IAAI,CAACqB,KAAL,CAAWC,IAFE;AAGnBC,MAAAA,KAAK,EAAEvB,IAAI,CAACqB,KAAL,CAAWE,KAAX,CAAiBf,GAAjB,CACL,CAAC;AAAEY,QAAAA,EAAF;AAAMI,QAAAA,QAAN;AAAgBC,QAAAA;AAAhB,OAAD,KAA8B,IAAI/B,QAAJ,CAAa;AAAE0B,QAAAA,EAAF;AAAMM,QAAAA,KAAK,EAAEF,QAAb;AAAuBG,QAAAA,IAAI,EAAEF;AAA7B,OAAb,CADzB;AAHY,KAAd,CAAP;AAOD;;AAED,QAAMG,QAAN,CAAe7B,KAAf,EAA8B8B,SAA9B,EAA0F;AACxF,UAAM1B,OAAO,GAAG;AACdC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAEN;AADT;AADK,KAAhB;AAKA,UAAM;AAAEC,MAAAA;AAAF,QAAW,MAAM,KAAKH,MAAL,CAAYiC,MAAZ,CAAiD;AACtEC,MAAAA,QAAQ,EAAEpC,cAAc,CAACqC,gBAD6C;AAEtEb,MAAAA,SAAS,EAAE;AACTG,QAAAA,IAAI,EAAEO,SAAS,CAACP;AADP,OAF2D;AAKtEnB,MAAAA,OALsE;AAMtE8B,MAAAA,cAAc,EAAE,CACd;AACEhC,QAAAA,KAAK,EAAEN,cAAc,CAACO,WADxB;AAEEC,QAAAA;AAFF,OADc;AANsD,KAAjD,CAAvB;AAcA,WAAOH,IAAI,GAAG,IAAIR,SAAJ,CAAc;AAAE4B,MAAAA,EAAE,EAAEpB,IAAI,CAACoB,EAAX;AAAeE,MAAAA,IAAI,EAAEtB,IAAI,CAACsB;AAA1B,KAAd,CAAH,GAAqD,IAAhE;AACD;;AAED,QAAMY,WAAN,CAAkBnC,KAAlB,EAAiCkB,OAAjC,EAAoE;AAClE,UAAMd,OAAO,GAAG;AACdC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAEN;AADT;AADK,KAAhB;AAKA,UAAM,KAAKF,MAAL,CAAYiC,MAAZ,CAAmB;AACvBC,MAAAA,QAAQ,EAAEpC,cAAc,CAACwC,mBADF;AAEvBhB,MAAAA,SAAS,EAAE;AACTF,QAAAA;AADS,OAFY;AAKvBd,MAAAA,OALuB;AAMvB8B,MAAAA,cAAc,EAAE,CACd;AACEhC,QAAAA,KAAK,EAAEN,cAAc,CAACO,WADxB;AAEEC,QAAAA;AAFF,OADc;AANO,KAAnB,CAAN;AAcA,WAAO,IAAP;AACD;;AAED,QAAMiC,OAAN,CAAcrC,KAAd,EAA6B8B,SAA7B,EAAgF;AAC9E,UAAM1B,OAAO,GAAG;AACdC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAEN;AADT;AADK,KAAhB;AAKA,UAAM;AAAEC,MAAAA;AAAF,QAAW,MAAM,KAAKH,MAAL,CAAYiC,MAAZ,CAAqE;AAC1FC,MAAAA,QAAQ,EAAEpC,cAAc,CAAC0C,eADiE;AAE1FlB,MAAAA,SAAS,EAAEU,SAF+E;AAG1F1B,MAAAA,OAH0F;AAI1F8B,MAAAA,cAAc,EAAE,CACd;AACEhC,QAAAA,KAAK,EAAEN,cAAc,CAACuB,UADxB;AAEEC,QAAAA,SAAS,EAAE;AACTF,UAAAA,OAAO,EAAEY,SAAS,CAACZ;AADV,SAFb;AAKEd,QAAAA;AALF,OADc;AAJ0E,KAArE,CAAvB;AAeA,WAAO,IAAIT,QAAJ,CAAa;AAAE0B,MAAAA,EAAE,EAAEpB,IAAI,CAACoB,EAAX;AAAeM,MAAAA,KAAK,EAAE1B,IAAI,CAACwB,QAA3B;AAAqCG,MAAAA,IAAI,EAAE3B,IAAI,CAACyB;AAAhD,KAAb,CAAP;AACD;;AA3KgB;;gBAPb9B,c,iBAQkCJ,GAAI;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,G;;gBAfMI,c,gBAgBiCJ,GAAI;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;gBA5BMI,c,sBA6BuCJ,GAAI;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,G;;gBApCMI,c,yBAqC0CJ,GAAI;AACpD;AACA;AACA;AACA,G;;gBAzCMI,c,qBA0CsCJ,GAAI;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;AAmIA,SAASI,cAAT","sourcesContent":["import { ApolloClient, NormalizedCacheObject, gql } from '@apollo/client'\nimport { RemoveTopicService } from '../../usecase/RemoveTopic'\nimport {\n  AddTopicService,\n  GetTopicsService,\n  TopicData,\n  AddTopicServiceParam,\n  AddCardServiceInput,\n  AddCardService,\n  GetTopicsObserverService,\n} from '../../usecase'\nimport { Observable } from '../../usecase/protocols'\nimport { Observer } from '../Observer'\nimport { Topic as TopicDB } from './entities/Topic'\nimport { CardData } from '../../usecase/protocols/CardData'\nimport { GetTopicService } from '../../usecase/GetTopic'\n\nclass GraphqlService\n  implements\n    GetTopicsService,\n    GetTopicsObserverService,\n    GetTopicService,\n    AddTopicService,\n    RemoveTopicService,\n    AddCardService {\n  private static readonly queryTopics = gql`\n    query Topics {\n      topics {\n        id\n        name\n      }\n    }\n  `\n  private static readonly queryTopic = gql`\n    query Topic($topicId: String!) {\n      topic(topicId: $topicId) {\n        id\n        name\n        cards {\n          id\n          question\n          answer\n        }\n      }\n    }\n  `\n  private static readonly mutationAddTopic = gql`\n    mutation AddTopic($name: String!) {\n      addTopic(name: $name) {\n        id\n        name\n      }\n    }\n  `\n  private static readonly mutationRemoveTopic = gql`\n    mutation RemoveTopic($topicId: String!) {\n      removeTopic(topicId: $topicId)\n    }\n  `\n  private static readonly mutationAddCard = gql`\n    mutation AddCard($topicId: String!, $question: String!, $answer: String!) {\n      addCard(topicId: $topicId, card: { question: $question, answer: $answer }) {\n        id\n        question\n        answer\n      }\n    }\n  `\n\n  constructor(private readonly client: ApolloClient<NormalizedCacheObject>) {}\n\n  async getTopics(token: string): Promise<TopicData[]> {\n    const { data } = await this.client.query<{ topics: TopicData[] }>({\n      query: GraphqlService.queryTopics,\n      context: {\n        headers: {\n          authentication: token,\n        },\n      },\n      fetchPolicy: 'no-cache',\n    })\n\n    return data.topics.map(topicData => new TopicData(topicData))\n  }\n\n  getTopicsObserver(token: string): Observable<TopicData[]> {\n    return new Observer((next, error) => {\n      const observable = this.client.watchQuery<{ topics: TopicData[] }>({\n        query: GraphqlService.queryTopics,\n        context: {\n          headers: {\n            authentication: token,\n          },\n        },\n      })\n      observable.subscribe({\n        next: ({ data }) => {\n          next(data.topics.map(topicData => new TopicData(topicData)))\n        },\n        error,\n      })\n    })\n  }\n\n  async getTopic(token: string, topicId: string): Promise<TopicData> {\n    const { data } = await this.client.query<{ topic: TopicDB }>({\n      query: GraphqlService.queryTopic,\n      variables: {\n        topicId,\n      },\n      context: {\n        headers: {\n          authentication: token,\n        },\n      },\n      fetchPolicy: 'no-cache',\n    })\n\n    return new TopicData({\n      id: data.topic.id,\n      name: data.topic.name,\n      cards: data.topic.cards.map(\n        ({ id, question, answer }) => new CardData({ id, front: question, back: answer }),\n      ),\n    })\n  }\n\n  async addTopic(token: string, inputData: AddTopicServiceParam): Promise<TopicData | null> {\n    const context = {\n      headers: {\n        authentication: token,\n      },\n    }\n    const { data } = await this.client.mutate<{ id: string; name: string }>({\n      mutation: GraphqlService.mutationAddTopic,\n      variables: {\n        name: inputData.name,\n      },\n      context,\n      refetchQueries: [\n        {\n          query: GraphqlService.queryTopics,\n          context,\n        },\n      ],\n    })\n\n    return data ? new TopicData({ id: data.id, name: data.name }) : null\n  }\n\n  async removeTopic(token: string, topicId: string): Promise<boolean> {\n    const context = {\n      headers: {\n        authentication: token,\n      },\n    }\n    await this.client.mutate({\n      mutation: GraphqlService.mutationRemoveTopic,\n      variables: {\n        topicId,\n      },\n      context,\n      refetchQueries: [\n        {\n          query: GraphqlService.queryTopics,\n          context,\n        },\n      ],\n    })\n\n    return true\n  }\n\n  async addCard(token: string, inputData: AddCardServiceInput): Promise<CardData> {\n    const context = {\n      headers: {\n        authentication: token,\n      },\n    }\n    const { data } = await this.client.mutate<{ id: string; question: string; answer: string }>({\n      mutation: GraphqlService.mutationAddCard,\n      variables: inputData,\n      context,\n      refetchQueries: [\n        {\n          query: GraphqlService.queryTopic,\n          variables: {\n            topicId: inputData.topicId,\n          },\n          context,\n        },\n      ],\n    })\n\n    return new CardData({ id: data.id, front: data.question, back: data.answer })\n  }\n}\n\nexport { GraphqlService }\n"]},"metadata":{},"sourceType":"module"}