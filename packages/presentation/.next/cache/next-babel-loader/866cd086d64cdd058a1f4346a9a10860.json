{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation RemoveTopic($topicId: String!) {\\n      removeTopic(topicId: $topicId)\\n    }\\n  \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation AddTopic($name: String!) {\\n      addTopic(name: $name) {\\n        id\\n        name\\n      }\\n    }\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    query Topics {\\n      topics {\\n        id\\n        name\\n      }\\n    }\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { gql } from '@apollo/client';\nimport { TopicData } from '../../usecase';\nimport { Observer } from '../Observer';\n\nvar GraphqlService = /*#__PURE__*/function () {\n  function GraphqlService(client) {\n    _classCallCheck(this, GraphqlService);\n\n    this.client = client;\n  }\n\n  _createClass(GraphqlService, [{\n    key: \"getTopics\",\n    value: function () {\n      var _getTopics = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(token) {\n        var _yield$this$client$qu, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.client.query({\n                  query: GraphqlService.queryTopics,\n                  context: {\n                    headers: {\n                      authentication: token\n                    }\n                  },\n                  fetchPolicy: 'no-cache'\n                });\n\n              case 2:\n                _yield$this$client$qu = _context.sent;\n                data = _yield$this$client$qu.data;\n                return _context.abrupt(\"return\", data.topics.map(function (topicData) {\n                  return new TopicData(topicData);\n                }));\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getTopics(_x) {\n        return _getTopics.apply(this, arguments);\n      }\n\n      return getTopics;\n    }()\n  }, {\n    key: \"getTopicsObserver\",\n    value: function getTopicsObserver(token) {\n      var _this = this;\n\n      return new Observer(function (_next, error) {\n        var observable = _this.client.watchQuery({\n          query: GraphqlService.queryTopics,\n          context: {\n            headers: {\n              authentication: token\n            }\n          }\n        });\n\n        observable.subscribe({\n          next: function next(_ref) {\n            var data = _ref.data;\n            console.log('next');\n\n            _next(data.topics.map(function (topicData) {\n              return new TopicData(topicData);\n            }));\n          },\n          error: error\n        });\n      });\n    }\n  }, {\n    key: \"addTopic\",\n    value: function () {\n      var _addTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token, inputData) {\n        var context, _yield$this$client$mu, data;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                context = {\n                  headers: {\n                    authentication: token\n                  }\n                };\n                _context2.next = 3;\n                return this.client.mutate({\n                  mutation: GraphqlService.mutationAddTopic,\n                  variables: {\n                    name: inputData.name\n                  },\n                  context: context,\n                  refetchQueries: [{\n                    query: GraphqlService.queryTopics,\n                    context: context\n                  }]\n                });\n\n              case 3:\n                _yield$this$client$mu = _context2.sent;\n                data = _yield$this$client$mu.data;\n                return _context2.abrupt(\"return\", data ? new TopicData(_objectSpread({}, data)) : null);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function addTopic(_x2, _x3) {\n        return _addTopic.apply(this, arguments);\n      }\n\n      return addTopic;\n    }()\n  }, {\n    key: \"removeTopic\",\n    value: function () {\n      var _removeTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(token, topicId) {\n        var context;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                context = {\n                  headers: {\n                    authentication: token\n                  }\n                };\n                _context3.next = 3;\n                return this.client.mutate({\n                  mutation: GraphqlService.mutationRemoveTopic,\n                  variables: {\n                    topicId: topicId\n                  },\n                  context: context,\n                  refetchQueries: [{\n                    query: GraphqlService.queryTopics,\n                    context: context\n                  }]\n                });\n\n              case 3:\n                return _context3.abrupt(\"return\", true);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function removeTopic(_x4, _x5) {\n        return _removeTopic.apply(this, arguments);\n      }\n\n      return removeTopic;\n    }()\n  }]);\n\n  return GraphqlService;\n}();\n\n_defineProperty(GraphqlService, \"queryTopics\", gql(_templateObject()));\n\n_defineProperty(GraphqlService, \"mutationAddTopic\", gql(_templateObject2()));\n\n_defineProperty(GraphqlService, \"mutationRemoveTopic\", gql(_templateObject3()));\n\nexport { GraphqlService };","map":{"version":3,"sources":["/Users/daniel.nakamashi/Documents/projects/clean-flashcards/node_modules/@flashcards/client/src/service/graphql/service.ts"],"names":["gql","TopicData","Observer","GraphqlService","client","token","query","queryTopics","context","headers","authentication","fetchPolicy","data","topics","map","topicData","next","error","observable","watchQuery","subscribe","console","log","inputData","mutate","mutation","mutationAddTopic","variables","name","refetchQueries","topicId","mutationRemoveTopic"],"mappings":"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","sourcesContent":["import { ApolloClient, NormalizedCacheObject, gql } from '@apollo/client'\nimport { RemoveTopicService } from '../../usecase/RemoveTopic'\nimport { AddTopicService, GetTopicsService, TopicData, AddTopicServiceParam } from '../../usecase'\nimport { Observable } from '../../usecase/protocols'\nimport { Observer } from '../Observer'\n\nclass GraphqlService implements GetTopicsService, AddTopicService, RemoveTopicService {\n  private static readonly queryTopics = gql`\n    query Topics {\n      topics {\n        id\n        name\n      }\n    }\n  `\n  private static readonly mutationAddTopic = gql`\n    mutation AddTopic($name: String!) {\n      addTopic(name: $name) {\n        id\n        name\n      }\n    }\n  `\n\n  private static readonly mutationRemoveTopic = gql`\n    mutation RemoveTopic($topicId: String!) {\n      removeTopic(topicId: $topicId)\n    }\n  `\n\n  constructor(private readonly client: ApolloClient<NormalizedCacheObject>) {}\n\n  async getTopics(token: string): Promise<TopicData[]> {\n    const { data } = await this.client.query<{ topics: TopicData[] }>({\n      query: GraphqlService.queryTopics,\n      context: {\n        headers: {\n          authentication: token,\n        },\n      },\n      fetchPolicy: 'no-cache',\n    })\n\n    return data.topics.map(topicData => new TopicData(topicData))\n  }\n\n  getTopicsObserver(token: string): Observable<TopicData[]> {\n    return new Observer((next, error) => {\n      const observable = this.client.watchQuery<{ topics: TopicData[] }>({\n        query: GraphqlService.queryTopics,\n        context: {\n          headers: {\n            authentication: token,\n          },\n        },\n      })\n      observable.subscribe({\n        next: ({ data }) => {\n          console.log('next')\n          next(data.topics.map(topicData => new TopicData(topicData)))\n        },\n        error,\n      })\n    })\n  }\n\n  async addTopic(token: string, inputData: AddTopicServiceParam): Promise<TopicData | null> {\n    const context = {\n      headers: {\n        authentication: token,\n      },\n    }\n    const { data } = await this.client.mutate<{ id: string; name: string }>({\n      mutation: GraphqlService.mutationAddTopic,\n      variables: {\n        name: inputData.name,\n      },\n      context,\n      refetchQueries: [\n        {\n          query: GraphqlService.queryTopics,\n          context,\n        },\n      ],\n    })\n\n    return data ? new TopicData({ ...data }) : null\n  }\n\n  async removeTopic(token: string, topicId: string): Promise<boolean> {\n    const context = {\n      headers: {\n        authentication: token,\n      },\n    }\n    await this.client.mutate({\n      mutation: GraphqlService.mutationRemoveTopic,\n      variables: {\n        topicId,\n      },\n      context,\n      refetchQueries: [\n        {\n          query: GraphqlService.queryTopics,\n          context,\n        },\n      ],\n    })\n\n    return true\n  }\n}\n\nexport { GraphqlService }\n"]},"metadata":{},"sourceType":"module"}